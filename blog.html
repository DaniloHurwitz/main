<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>The Freelancer's Compass Blog</title>
<link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;500;700&display=swap" rel="stylesheet">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css" integrity="sha512-DTOQO9RWCH3ppGqcWaEA1BIZOC6xxalwEsw9c2QQeAIftl+Vegovlnee1c9QX4TctnWMn13TZye+giMm8e2LwA==" crossorigin="anonymous" referrerpolicy="no-referrer" />
<style>
  :root {
    /* Paleta */
    --primary-color: #87CEEB;
    --accent-color: #FFD700;
    --accent-dark: #e6c300;
    --text-color: #2C3E50;
    --link-color: #4682B4;
    --summary-color: #708090;
    --container-bg: rgba(255, 255, 255, 0.92); /* Ligeramente m√°s opaco */
    --border-color: #B3E5FC;
    --shadow-color: rgba(0,0,0,0.12); /* Sombra un poco m√°s definida */
    --highlight-bg: rgba(255,215,0,0.3);
    --highlight-text: #2C3E50;
    --control-bg: rgba(240, 248, 255, 0.9); /* Controles m√°s opacos */
    /* Colores Blackjack */
    --bj-bg: #006400; /* Verde mesa */
    --bj-card-bg: #ffffff;
    --bj-card-border: #ccc;
    --bj-text-light: #f0f0f0;
    --bj-button-bg: #4CAF50;
    --bj-button-hover: #45a049;
    --bj-button-disabled: #aaa;
    --bj-red: #D22;
    --bj-black: #333;
  }

  /* --- Estilos base, body, nubes --- */
  * { box-sizing: border-box; margin: 0; padding: 0; }
  html { scroll-behavior: smooth; }
  body {
    font-family: 'Roboto', Arial, sans-serif;
    background: linear-gradient(to bottom, #a1d4f4 40%, #e6f3ff 100%);
    color: var(--text-color);
    line-height: 1.6;
    display: flex;
    flex-direction: column;
    min-height: 100vh;
    position: relative;
    overflow-x: hidden;
    transition: background 0.5s ease;
    padding-top: 80px; /* Espacio para el bot√≥n Back fijo */
  }
  body::before, body::after { /* Nubes */
    content: ''; position: fixed; top: 0; left: 0; width: 200%; height: 100%;
    /* !!! REEMPLAZA ESTA URL POR LA DE TU IMAGEN DE NUBES PNG TRANSPARENTE !!! */
    background-image: url('URL_DE_TU_IMAGEN_DE_NUBES_PNG_TRANSPARENTE');
    background-repeat: repeat-x; background-size: contain; z-index: -1; opacity: 0.15;
    transition: transform 15s linear; will-change: transform;
  }
  body::before { background-position: 0% 20%; animation: moveClouds 60s linear infinite alternate; }
  body::after { background-position: 50% 50%; opacity: 0.1; animation: moveClouds 40s linear infinite alternate-reverse; }
  @keyframes moveClouds { from { transform: translateX(0%); } to { transform: translateX(-50%); } }
  body:hover::before, body:hover::after { transition: transform 2s ease-out; }

  /* --- BOT√ìN BACK GLOBAL FIJO --- */
  #global-back-button {
    display: inline-block; padding: 10px 20px; background-color: var(--accent-color);
    color: var(--text-color); text-decoration: none; border-radius: 8px; font-weight: 500;
    transition: background-color 0.3s ease, transform 0.2s ease, box-shadow 0.3s ease;
    border: none; cursor: pointer; position: fixed; top: 20px; left: 20px; z-index: 1001;
    box-shadow: 0 2px 5px rgba(0,0,0,0.2); white-space: nowrap;
  }
  #global-back-button:hover { background-color: var(--accent-dark); transform: translateY(-2px); box-shadow: 0 4px 8px rgba(0,0,0,0.3); }

  /* --- Contenedor Principal --- */
  .container {
    max-width: 800px;
    margin: 0 auto 40px auto; /* Margen superior 0, el padding del body da espacio */
    padding: 25px 35px; background-color: var(--container-bg); border-radius: 10px;
    box-shadow: 0 4px 15px var(--shadow-color); flex-grow: 1; border: 1px solid rgba(179, 229, 252, 0.5);
    z-index: 1; position: relative;
  }

  /* --- Header --- */
  header {
    display: flex; align-items: center; justify-content: center; /* Centra el t√≠tulo */
    margin-bottom: 30px; padding-bottom: 15px; border-bottom: 1px solid var(--border-color);
    min-height: 50px; position: relative; /* Mantenido relativo */
  }
  .main-title {
    color: var(--primary-color); text-align: center; font-size: 2.3em;
    font-weight: 700; margin: 0; line-height: 1.2;
    /* Ya no necesita padding lateral */
  }
  /* La regla .back-button ya no aplica aqu√≠ */


  /* --- Controles --- */
  .controls-container { display: flex; flex-direction: column; gap: 15px; margin-bottom: 30px; padding: 15px; background-color: var(--control-bg); border-radius: 8px; border: 1px solid var(--border-color); }
  .search-sort-wrapper { display: flex; justify-content: space-between; align-items: center; gap: 20px; width: 100%; }
  .search-container { flex-grow: 1; position: relative; margin-bottom: 0; }
  #search-input { width: 100%; padding: 12px 20px 12px 45px; background-color: var(--container-bg); color: var(--text-color); border: 1px solid var(--border-color); border-radius: 24px; font-size: 16px; outline: none; transition: border-color 0.3s ease, box-shadow 0.3s ease; }
  #search-input:focus { border-color: var(--primary-color); box-shadow: 0 0 5px var(--primary-color); }
  .search-container::before { content: 'üîç'; position: absolute; left: 15px; top: 50%; transform: translateY(-50%); font-size: 18px; color: #9aa0a6; pointer-events: none; }
  .sort-filter-controls { display: flex; align-items: center; gap: 15px; flex-shrink: 0; }
  .sort-filter-controls label { font-weight: 500; color: var(--text-color); margin-right: 5px; white-space: nowrap; }
  .sort-filter-controls select { padding: 8px 12px; border-radius: 5px; border: 1px solid var(--border-color); background-color: var(--container-bg); color: var(--text-color); font-size: 14px; cursor: pointer; transition: border-color 0.3s ease; }
  .sort-filter-controls select:focus { outline: none; border-color: var(--primary-color); box-shadow: 0 0 3px var(--primary-color); }
  .quick-filters { display: flex; align-items: center; flex-wrap: wrap; gap: 10px 15px; padding-top: 10px; border-top: 1px dashed var(--border-color); width: 100%; }
  .filter-label { font-weight: 500; color: var(--text-color); margin-right: 5px; }
  .checkbox-label { display: flex; align-items: center; cursor: pointer; font-size: 0.9em; color: var(--summary-color); transition: color 0.3s ease; }
  .checkbox-label:hover { color: var(--text-color); }
  .checkbox-label input[type="checkbox"] { margin-right: 6px; cursor: pointer; accent-color: var(--primary-color); transform: scale(1.1); }

  /* --- Resultados y Paginaci√≥n --- */
  #results-container { opacity: 1; transition: opacity 0.3s ease-out; }
  .blog-result { margin-bottom: 25px; padding-bottom: 15px; border-bottom: 1px dashed var(--border-color); animation: fadeIn 0.5s ease-out forwards; }
  .blog-result:last-child { border-bottom: none; }
  .blog-title { color: var(--link-color); font-size: 19px; font-weight: 500; text-decoration: none; display: inline-block; transition: transform 0.2s ease; }
  .blog-title:hover { text-decoration: underline; transform: translateX(3px); }
  .blog-link { color: var(--primary-color); font-size: 14px; display: block; margin-top: 3px; word-break: break-all; opacity: 0.8; }
  .blog-summary { color: var(--summary-color); font-size: 14px; margin-top: 5px; }
  #pagination-container { text-align: center; margin-top: 30px; padding-top: 20px; border-top: 1px solid var(--border-color); transition: opacity 0.3s ease-out; }
  .pagination-button { display: inline-block; padding: 8px 12px; margin: 0 5px; background-color: var(--container-bg); color: var(--link-color); border: 1px solid var(--border-color); border-radius: 4px; text-decoration: none; cursor: pointer; transition: background-color 0.3s ease, color 0.3s ease, border-color 0.3s ease; }
  .pagination-button:hover:not(.disabled) { background-color: var(--primary-color); color: #fff; border-color: var(--primary-color); }
  .pagination-button.active { background-color: var(--link-color); color: #fff; border-color: var(--link-color); font-weight: bold; cursor: default; }
  .pagination-button.disabled { color: #ccc; border-color: #eee; cursor: not-allowed; background-color: #f9f9f9; }
  .no-results { text-align: center; color: var(--summary-color); font-style: italic; margin-top: 20px; }
  mark { background-color: var(--highlight-bg); color: var(--highlight-text); padding: 0.1em 0.2em; border-radius: 3px; font-weight: 500; }
  @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }

  /* --- Estilos Blackjack --- */
  #blackjack-game { display: none; background-color: var(--bj-bg); color: var(--bj-text-light); padding: 25px; border-radius: 10px; margin-top: 20px; box-shadow: 0 5px 15px rgba(0,0,0,0.3); border: 3px solid var(--accent-dark); animation: fadeIn 0.5s ease-out; text-align: center; }
  #blackjack-game h2 { color: var(--accent-color); margin-bottom: 20px; font-size: 1.8em; }
  .hand { margin: 15px 0; min-height: 80px; }
  .hand h3 { margin-bottom: 10px; font-size: 1.1em; color: var(--bj-text-light); }
  .cards { display: flex; justify-content: center; gap: 8px; flex-wrap: wrap; }
  .card { background-color: var(--bj-card-bg); color: var(--bj-black); border: 1px solid var(--bj-card-border); border-radius: 5px; padding: 10px 8px; font-size: 1.4em; min-width: 40px; text-align: center; font-weight: bold; box-shadow: 1px 1px 3px rgba(0,0,0,0.2); display: inline-block; }
  .card.red { color: var(--bj-red); }
  .card.hidden { background-color: #B00; color: transparent; border: 1px solid #800; }
  #blackjack-message { margin: 20px 0; font-size: 1.2em; font-weight: bold; min-height: 1.5em; color: var(--accent-color); }
  .blackjack-buttons button { padding: 12px 25px; margin: 0 10px; background-color: var(--bj-button-bg); color: white; border: none; border-radius: 5px; cursor: pointer; font-size: 1em; font-weight: bold; transition: background-color 0.3s ease, transform 0.2s ease; }
  .blackjack-buttons button:hover:not(:disabled) { background-color: var(--bj-button-hover); transform: translateY(-2px); }
  .blackjack-buttons button:disabled { background-color: var(--bj-button-disabled); cursor: not-allowed; opacity: 0.7; }

</style>
</head>
<body>

<a href="index.html" id="global-back-button" title="Back to Main Menu">‚Üê Back</a>

<div class="container">
  <header>
    <h1 class="main-title">The Freelancer's Compass Blog</h1>
  </header>

  <div class="controls-container">
    <div class="search-sort-wrapper">
        <div class="search-container">
          <input type="text" id="search-input" placeholder="Search by title or content...">
        </div>
        <div class="sort-filter-controls">
          <label for="sort-select">Order by:</label>
          <select id="sort-select">
            <option value="newest">Newest First</option>
            <option value="oldest">Oldest First</option>
            <option value="title-asc">Title (A-Z)</option>
            <option value="title-desc">Title (Z-A)</option>
          </select>
        </div>
    </div>
    <div class="quick-filters">
        <span class="filter-label">Quick Filters:</span>
        <label class="checkbox-label"> <input type="checkbox" name="quickFilter" value="How to"> How to... </label>
        <label class="checkbox-label"> <input type="checkbox" name="quickFilter" value="Tips"> Tips & Tricks </label>
        <label class="checkbox-label"> <input type="checkbox" name="quickFilter" value="Mistakes"> Common Mistakes </label>
        <label class="checkbox-label"> <input type="checkbox" name="quickFilter" value="Guide"> Guides </label>
    </div>
  </div>

  <div id="results-container">
    </div>

  <div id="pagination-container">
    </div>

  <div id="blackjack-game">
      <h2><i class="fas fa-cards-blank"></i> Blackjack Easter Egg! <i class="fas fa-spade"></i></h2>
      <div class="hand">
          <h3>Dealer's Hand (<span id="dealer-score">0</span>):</h3>
          <div id="dealer-cards" class="cards"></div>
      </div>
      <div class="hand">
          <h3>Your Hand (<span id="player-score">0</span>):</h3>
          <div id="player-cards" class="cards"></div>
      </div>
      <div id="blackjack-message">Click Deal to start!</div>
      <div class="blackjack-buttons">
          <button id="bj-hit" disabled>Hit (Pedir)</button>
          <button id="bj-stand" disabled>Stand (Plantarse)</button>
          <button id="bj-deal">Deal (Repartir)</button>
      </div>
  </div>

</div>

<script>
  // --- Variables Globales ---
  const resultsContainer = document.getElementById('results-container');
  const searchInput = document.getElementById('search-input');
  const paginationContainer = document.getElementById('pagination-container');
  const sortSelect = document.getElementById('sort-select');
  const quickFilterCheckboxes = document.querySelectorAll('input[name="quickFilter"]');
  const blackjackGameDiv = document.getElementById('blackjack-game');

  let allBlogs = [];
  let processedBlogs = [];
  const itemsPerPage = 5;
  let currentPage = 1;
  let currentSort = 'newest';

  // --- L√≥gica del Blog ---
  function processBlogs() {
    const searchTerm = searchInput.value.toLowerCase().trim();

    if (searchTerm === 'blackjack') {
      showBlackjack();
      return;
    } else {
      hideBlackjack(); // Asegura ocultar si no es la b√∫squeda
    }

    const selectedFilters = [];
    quickFilterCheckboxes.forEach(checkbox => { if (checkbox.checked) selectedFilters.push(checkbox.value.toLowerCase()); });

    let tempBlogs = allBlogs.filter(blog => (searchTerm === '') || blog.title.toLowerCase().includes(searchTerm) || blog.summary.toLowerCase().includes(searchTerm));

    if (selectedFilters.length > 0) {
      tempBlogs = tempBlogs.filter(blog => { const blogContent = (blog.title + ' ' + blog.summary).toLowerCase(); return selectedFilters.some(filterTerm => blogContent.includes(filterTerm)); });
    }

    currentSort = sortSelect.value;
    switch (currentSort) {
      case 'newest': tempBlogs.sort((a, b) => new Date(b.date || 0) - new Date(a.date || 0)); break;
      case 'oldest': tempBlogs.sort((a, b) => new Date(a.date || 0) - new Date(b.date || 0)); break;
      case 'title-asc': tempBlogs.sort((a, b) => a.title.localeCompare(b.title)); break;
      case 'title-desc': tempBlogs.sort((a, b) => b.title.localeCompare(a.title)); break;
      default: break;
    }

    processedBlogs = tempBlogs;
    displayBlogs(processedBlogs, 1);
  }

  function displayBlogs(blogsToDisplay, page) {
    resultsContainer.innerHTML = ''; resultsContainer.style.opacity = 0; page = page || 1; currentPage = page;
    const startIndex = (page - 1) * itemsPerPage; const endIndex = startIndex + itemsPerPage; const paginatedItems = blogsToDisplay.slice(startIndex, endIndex);
    if (paginatedItems.length === 0) { resultsContainer.innerHTML = '<p class="no-results">No blogs matched your search or filters.</p>'; }
    else { paginatedItems.forEach((blog, index) => {
        const div = document.createElement('div'); div.className = 'blog-result'; div.style.animationDelay = `${index * 0.05}s`;
        div.innerHTML = `<a href="${blog.link}" target="_blank" class="blog-title">${highlightMatch(blog.title, searchInput.value)}</a> <span class="blog-link">${blog.link}</span> <p class="blog-summary">${highlightMatch(blog.summary, searchInput.value)}</p>`;
        resultsContainer.appendChild(div); });
    }
    setTimeout(() => { resultsContainer.style.opacity = 1; }, 50); setupPagination(blogsToDisplay);
  }

  function setupPagination(blogsToDisplay) {
    paginationContainer.innerHTML = ''; const pageCount = Math.ceil(blogsToDisplay.length / itemsPerPage); if (pageCount <= 1) return;
    const prevButton = document.createElement('button'); prevButton.textContent = '¬´ Previous'; prevButton.className = 'pagination-button'; if (currentPage === 1) { prevButton.classList.add('disabled'); prevButton.disabled = true; }
    prevButton.addEventListener('click', () => { if (currentPage > 1) { displayBlogs(blogsToDisplay, currentPage - 1); window.scrollTo(0, 0); } }); paginationContainer.appendChild(prevButton);
    const maxPagesToShow = 5; let startPage = Math.max(1, currentPage - Math.floor(maxPagesToShow / 2)); let endPage = Math.min(pageCount, startPage + maxPagesToShow - 1); if (endPage - startPage + 1 < maxPagesToShow) startPage = Math.max(1, endPage - maxPagesToShow + 1);
    if (startPage > 1) {
        const firstPageButton = document.createElement('button'); firstPageButton.textContent = '1'; firstPageButton.className = 'pagination-button'; firstPageButton.addEventListener('click', () => { displayBlogs(blogsToDisplay, 1); window.scrollTo(0, 0); }); paginationContainer.appendChild(firstPageButton);
        if (startPage > 2) { const ellipsis = document.createElement('span'); ellipsis.textContent = '...'; ellipsis.style.margin = '0 8px'; ellipsis.style.color = 'var(--summary-color)'; paginationContainer.appendChild(ellipsis); }
    }
    for (let i = startPage; i <= endPage; i++) {
        const pageButton = document.createElement('button'); pageButton.textContent = i; pageButton.className = 'pagination-button'; if (i === currentPage) pageButton.classList.add('active');
        pageButton.addEventListener('click', () => { displayBlogs(blogsToDisplay, i); window.scrollTo(0, 0); }); paginationContainer.appendChild(pageButton);
    }
    if (endPage < pageCount) {
        if (endPage < pageCount - 1) { const ellipsis = document.createElement('span'); ellipsis.textContent = '...'; ellipsis.style.margin = '0 8px'; ellipsis.style.color = 'var(--summary-color)'; paginationContainer.appendChild(ellipsis); }
        const lastPageButton = document.createElement('button'); lastPageButton.textContent = pageCount; lastPageButton.className = 'pagination-button'; lastPageButton.addEventListener('click', () => { displayBlogs(blogsToDisplay, pageCount); window.scrollTo(0, 0); }); paginationContainer.appendChild(lastPageButton);
    }
    const nextButton = document.createElement('button'); nextButton.textContent = 'Next ¬ª'; nextButton.className = 'pagination-button'; if (currentPage === pageCount) { nextButton.classList.add('disabled'); nextButton.disabled = true; }
    nextButton.addEventListener('click', () => { if (currentPage < pageCount) { displayBlogs(blogsToDisplay, currentPage + 1); window.scrollTo(0, 0); } }); paginationContainer.appendChild(nextButton);
  }

  function highlightMatch(text, term) {
    if (!term || term.trim() === '') return text; const escapedTerm = term.replace(/[.*+?^${}()|[\]\\]/g, '\\$&'); const regex = new RegExp(`(${escapedTerm})`, 'gi'); return text.replace(regex, '<mark>$1</mark>');
  }

  fetch('blogs.json')
    .then(response => { if (!response.ok) { throw new Error(`HTTP error! status: ${response.status}`); } const contentType = response.headers.get("content-type"); if (!contentType || !contentType.includes("application/json")) { throw new TypeError("Oops, no recibimos JSON!"); } return response.json(); })
    .then(blogs => { if (!Array.isArray(blogs)) { throw new TypeError("El archivo JSON no contiene un array de blogs."); }
      allBlogs = blogs.map((blog, index) => ({ ...blog, date: blog.date || new Date(Date.now() - index * 86400000).toISOString().split('T')[0] }));
      processBlogs();
    })
    .catch(error => { console.error('Error loading or processing blogs:', error); resultsContainer.innerHTML = `<p class="no-results" style="color: red;">${error.message}. Make sure 'blogs.json' exists, is in the same folder, and has the correct JSON format (an array [...] of objects {...}).</p>`; resultsContainer.style.opacity = 1; });

  searchInput.addEventListener('input', processBlogs);
  sortSelect.addEventListener('change', processBlogs);
  quickFilterCheckboxes.forEach(checkbox => { checkbox.addEventListener('change', processBlogs); });

  // --- L√≥gica Blackjack ---
  let deck = [], playerCards = [], dealerCards = [], playerScore = 0, dealerScore = 0, gameOver = true, dealerTurnTimeout; // Timeout para turno dealer
  const dealerCardsDiv = document.getElementById('dealer-cards');
  const playerCardsDiv = document.getElementById('player-cards');
  const dealerScoreSpan = document.getElementById('dealer-score');
  const playerScoreSpan = document.getElementById('player-score');
  const messageDiv = document.getElementById('blackjack-message');
  const hitButton = document.getElementById('bj-hit');
  const standButton = document.getElementById('bj-stand');
  const dealButton = document.getElementById('bj-deal');

  function createDeck() { /* ... (igual que antes) ... */
      const suits = ['‚ô•', '‚ô¶', '‚ô£', '‚ô†']; const ranks = ['A', '2', '3', '4', '5', '6', '7', '8', '9', '10', 'J', 'Q', 'K']; deck = [];
      for (const suit of suits) { for (const rank of ranks) { deck.push({ suit, rank }); } }
  }
  function shuffleDeck() { /* ... (igual que antes) ... */
      for (let i = deck.length - 1; i > 0; i--) { const j = Math.floor(Math.random() * (i + 1)); [deck[i], deck[j]] = [deck[j], deck[i]]; }
  }
  function getCardValue(card) { /* ... (igual que antes) ... */
      if (['K', 'Q', 'J'].includes(card.rank)) return 10; if (card.rank === 'A') return 11; return parseInt(card.rank);
  }
  function calculateHandValue(hand) { /* ... (igual que antes) ... */
      let sum = 0; let aceCount = 0; for (const card of hand) { sum += getCardValue(card); if (card.rank === 'A') aceCount++; }
      while (sum > 21 && aceCount > 0) { sum -= 10; aceCount--; } return sum;
  }
  function renderCard(card, targetDiv, isHidden = false) { /* ... (igual que antes) ... */
      const cardDiv = document.createElement('div'); cardDiv.className = 'card'; if (isHidden) { cardDiv.classList.add('hidden'); cardDiv.textContent = '?'; }
      else { cardDiv.textContent = `${card.rank}${card.suit}`; if (['‚ô•', '‚ô¶'].includes(card.suit)) cardDiv.classList.add('red'); }
      targetDiv.appendChild(cardDiv);
  }
  function renderHands(hideDealerCard = true) { /* ... (igual que antes) ... */
      dealerCardsDiv.innerHTML = ''; playerCardsDiv.innerHTML = ''; dealerCards.forEach((card, index) => renderCard(card, dealerCardsDiv, hideDealerCard && index === 0)); playerCards.forEach(card => renderCard(card, playerCardsDiv));
      playerScore = calculateHandValue(playerCards); dealerScore = hideDealerCard ? calculateHandValue(dealerCards.slice(1)) : calculateHandValue(dealerCards);
      playerScoreSpan.textContent = playerScore; dealerScoreSpan.textContent = hideDealerCard ? `${dealerScore} + ?` : dealerScore;
  }

  function playerHit() { /* ... (igual que antes) ... */
    if (gameOver) return; playerCards.push(deck.pop()); renderHands(); if (playerScore > 21) endGame("You busted! Dealer wins.");
  }

  // --- FUNCI√ìN playerStand CORREGIDA ---
  function playerStand() {
      if (gameOver) return;
      gameOver = true; // El jugador ya no puede hacer m√°s acciones
      hitButton.disabled = true;
      standButton.disabled = true;

      // Revelar carta oculta y mostrar score real
      dealerScore = calculateHandValue(dealerCards);
      renderHands(false); // Mostrar todas las cartas del dealer

      // L√≥gica recursiva y as√≠ncrona del dealer con delays
      function dealerTurn() {
          dealerScore = calculateHandValue(dealerCards); // Recalcular por si acaso
          renderHands(false); // Asegurarse de que est√© visible el score correcto

          if (dealerScore < 17) {
              messageDiv.textContent = "Dealer hits...";
              dealerTurnTimeout = setTimeout(() => { // Guardar el timeout ID
                  if (deck.length > 0) { // Asegurarse que haya cartas
                      dealerCards.push(deck.pop());
                      dealerTurn(); // Llamada recursiva para el pr√≥ximo turno/delay
                  } else {
                      // No quedan cartas, determinar ganador con lo que hay
                      determineWinner();
                  }
              }, 800); // Delay m√°s largo para ver la acci√≥n
          } else {
              // El dealer se planta (>= 17)
              determineWinner();
          }
      }
      dealerTurn(); // Iniciar el turno del dealer
  }


  function determineWinner() { /* ... (igual que antes) ... */
    clearTimeout(dealerTurnTimeout); // Limpiar timeout por si acaso
    dealerScore = calculateHandValue(dealerCards); renderHands(false); // Asegura score final y cartas visibles
    let msg = "";
    if (playerScore > 21) { msg = "You busted! Dealer wins."; }
    else if (dealerScore > 21) { msg = "Dealer busted! You win!"; }
    else if (playerScore > dealerScore) { msg = "You win!"; }
    else if (dealerScore > playerScore) { msg = "Dealer wins."; }
    else { msg = "Push! (It's a tie)"; }
    endGame(msg);
  }

  function endGame(msg) { /* ... (igual que antes) ... */
    gameOver = true; messageDiv.textContent = msg; hitButton.disabled = true; standButton.disabled = true;
    dealButton.disabled = false; dealButton.textContent = "New Game";
    clearTimeout(dealerTurnTimeout); // Limpiar cualquier timeout pendiente del dealer
  }

  function startBlackjack() { /* ... (igual que antes) ... */
    clearTimeout(dealerTurnTimeout); // Limpiar timeout de juegos anteriores
    createDeck(); shuffleDeck(); playerCards = [deck.pop(), deck.pop()]; dealerCards = [deck.pop(), deck.pop()]; gameOver = false;
    renderHands(); messageDiv.textContent = "Hit or Stand?"; hitButton.disabled = false; standButton.disabled = false; dealButton.disabled = true; dealButton.textContent = "Deal";
    playerScore = calculateHandValue(playerCards); const dealerVisibleScore = calculateHandValue(dealerCards.slice(1));
    if (playerScore === 21) { if (dealerVisibleScore >= 10) { playerStand(); } else { endGame("Blackjack! You win!"); } }
  }

  // --- Funciones show/hide (igual que antes) ---
  function showBlackjack() { resultsContainer.style.display = 'none'; paginationContainer.style.display = 'none'; blackjackGameDiv.style.display = 'block'; if(gameOver) startBlackjack(); }
  function hideBlackjack() { resultsContainer.style.display = 'block'; paginationContainer.style.display = 'block'; blackjackGameDiv.style.display = 'none'; }

  // --- Listeners Blackjack ---
  hitButton.addEventListener('click', playerHit);
  standButton.addEventListener('click', playerStand);
  dealButton.addEventListener('click', startBlackjack);

</script>

</body>
</html>
